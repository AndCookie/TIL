<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Insert title here</title>
	<script th:src="@{/jquery-3.7.0.min.js}"></script>
	<script>
		$(function() {
			$("#req1").on('click', req1);
			$("#ajaxReq2").on('click', req2);
			$("#ajaxReq3").on('click', req3);
			$("#ajaxReq4").on('click', req4);
		});
		
		function req4(){
			// 요청 ---> List로 받음
			$.ajax({
				url : 'ajaxReq4'
				, method : 'GET'
				, success : output
			});
		}
		
		// 처리결과 출력 (테이블로 생성한 후 #req4result)
		function output(resp) {
			let tag = `
					<table border="1">
						<tr>
						<th>이름</th><th>전화번호</th><th>주소</th>
						</tr>`;
			
			// 방법 1 >
			// for (let i=0; i<3; i++) {
			//     let data = `<tr><td>`+resp[i]["name"]+`</td><td>`+resp[i]["phone"]+`</td><td>`+resp[i]["address"]+`</td></tr>`;
			//	   tag += data;
			// };
			
			// 방법  >
			// for (item of resp) {
			//     tag += `<tr> <td>${item["name"]}</td> <td>${item["phone"]}</td> <td>${item["address"]}</td> </tr>`;
			// };
			
			// 방법 3 >
			// jQuery 객체가 아니므로 [객체.each(function(idx,item))]의 형태로 사용 불가
			// 따라서 괄호의 첫 번째 전달인자로 배열을 집어넣기
			$.each(resp, function(idx, item) {
				tag += `<tr> <td>${item["name"]}</td> <td>${item["phone"]}</td> <td>${item["address"]}</td> </tr>`;
			});

			tag +=`</table>`;
			$("#req4result").html(tag);
		}
		
		function req3(){
			// 요청 ---> List로 받음
			$.ajax({
				url : 'ajaxReq3'
				, method : 'GET'
				, success : function(resp) { // resp는 배열 ArrayList
					let data = '';
					for (temp of resp) {
						data += temp + " ";
					}
					$("#req3result").text(data);
				}
			});
		}
		
		function req2(){
			let name = $("#name").val();
			let phone = $("#phone").val();
			let sendData = {"name":name, "phone":phone};
			
			// JSON <---> Map
			$.ajax({
				url:'ajaxReq2'
				, method:'POST'
				, data : sendData // 1)
				// , data : `name=${name}&phone=${phone}` // 2)
				, success : function(resp) { // resp를 JSON형태로 받은 것
					$("#req2result").text(JSON.stringify(resp)); // JSON을 문자열로 바꿔서 출력
				}
			})	
		}

		function req1(){
			alert("req1 클릭함");
			$.ajax({
				url : 'ajaxReq1'
				, method : 'GET'
				, success : function(resp) {
					// "도착"이라는 단어가 들어온 것을 let resp="도착"으로 받은 것
					alert(resp);
				}
			});
		}
		
	</script>
  </head>
  <body>
    <h2>[ Ajax를 이용한 데이터 송수신 ]</h2>
    <ul>
    	<li>
    		<input type="button" id="req1" value="1_Ajax로 서버에 요청보내기">
    	</li>
		<li>
			<label>이름 : <input type="text" id="name" ></label><br>
			<label>번호 : <input type="text" id="phone"></label><br>
			<input type="button" id="ajaxReq2" value="2_낱개의 데이터 보내고 Map으로 받기">
			<p id="req2result" style="color:red;"></p>
		</li>
		<li>
			<input type="button" id="ajaxReq3" value="3_데이터 없이 요청하고 ArrayList 받기 (송신 데이터 없음)">
			<p id="req3result" style="color:red;"></p>
		</li>
		<li>
			<input type="button" id="ajaxReq4" value="4_친구 목록 List 요청하고 ArrayList 받기 (송신 데이터 없음)">
			<p id="req4result" style="color:blue;"></p>
		</li>
		<li>
			<a th:href="@{/nextpage}">다음페이지</a>
		</li>
    </ul>
  </body>
</html>
